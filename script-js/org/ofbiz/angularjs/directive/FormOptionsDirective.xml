<?xml version="1.0" encoding="UTF-8"?>
<javascript-class name="FormOptionsDirective" package="org.ofbiz.angularjs.directive">
    <javascript-method name="controller" is-static="true">
        <attributes>
            <attribute name="$scope" type="Object" mode="IN"/>
            <attribute name="$element" type="Object" mode="IN"/>
            <attribute name="$attrs" type="Object" mode="IN"/>
            <attribute name="$transclude" type="Object" mode="IN"/>
            <attribute name="$http" type="Object" mode="IN"/>
            <attribute name="appBusy" type="Object" mode="IN"/>
        </attributes>
        <body><![CDATA[
            $scope.$http = $http;
            $scope.appBusy = appBusy;
            
            $scope.$on("ON_SUBMIT_SUCCESS", $scope[$attrs.onSubmitSuccess]);
            $scope.$on("ON_SUBMIT_ERROR", $scope[$attrs.onSubmitError]);
        ]]></body>
    </javascript-method>
    <javascript-method name="preLink" is-static="true">
        <attributes>
            <attribute name="scope" type="Object" mode="IN"/>
            <attribute name="iElement" type="Object" mode="IN"/>
            <attribute name="iAttrs" type="Object" mode="IN"/>
            <attribute name="controller" type="Object" mode="IN"/>
        </attributes>
        <body>
            
        </body>
    </javascript-method>
    <javascript-method name="postLink" is-static="true">
        <attributes>
            <attribute name="$scope" type="Object" mode="IN"/>
            <attribute name="$element" type="Object" mode="IN"/>
            <attribute name="$attrs" type="Object" mode="IN"/>
            <attribute name="controller" type="Object" mode="IN"/>
        </attributes>
        <body>
            if ($attrs.ngUpload == undefined) {
                var target = $attrs.target;
                
                $element.find("input[type=submit]").bind("click", function() {
                    var data = $element.serialize();
                    org.ofbiz.angularjs.directive.FormOptionsDirective.post($scope, target, data);
                });
            }
        </body>
    </javascript-method>
    <javascript-method name="post" is-static="true">
        <attributes>
            <attribute name="$scope" type="Object" mode="IN"/>
            <attribute name="target" type="String" mode="IN"/>
            <attribute name="data" type="String" mode="IN"/>
        </attributes>
        <body>
            $scope.appBusy.set();
            $scope.$http({method: "POST", url: target, data: data, headers: {"Content-Type": "application/x-www-form-urlencoded"}})
            .success(function(data, status, headers, config) {
                $scope.appBusy.set(false);
                if (data._ERROR_MESSAGE_ != undefined) {
                    $scope.$emit("ON_SUBMIT_ERROR", data, status, headers, config);
                } else {
                    $scope.$emit("ON_SUBMIT_SUCCESS", data, status, headers, config);
                }
            })
            .error(function(data, status, headers, config) {
                $scope.appBusy.set(false);
                $scope.$emit("ON_SUBMIT_ERROR", data, status, headers, config);
            });
        </body>
    </javascript-method>
</javascript-class>
